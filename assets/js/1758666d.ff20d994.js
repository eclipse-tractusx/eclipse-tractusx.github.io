"use strict";(self.webpackChunkeclipse_tractusx_github_io=self.webpackChunkeclipse_tractusx_github_io||[]).push([[34154],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>g});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(t),h=i,g=d["".concat(l,".").concat(h)]||d[h]||u[h]||o;return t?a.createElement(g,r(r({ref:n},p),{},{components:t})):a.createElement(g,r({ref:n},p))}));function g(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=h;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[d]="string"==typeof e?e:i,r[1]=s;for(var c=2;c<o;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},78768:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=t(87462),i=(t(67294),t(3905));const o={sidebar_position:2,title:"Agent-Enabled Dataspace Connector"},r=void 0,s={unversionedId:"kits/knowledge-agents/operation-view/agent_edc",id:"kits/knowledge-agents/operation-view/agent_edc",title:"Agent-Enabled Dataspace Connector",description:"\x3c!--",source:"@site/docs-kits/kits/knowledge-agents/operation-view/agent_edc.md",sourceDirName:"kits/knowledge-agents/operation-view",slug:"/kits/knowledge-agents/operation-view/agent_edc",permalink:"/docs-kits/next/kits/knowledge-agents/operation-view/agent_edc",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Agent-Enabled Dataspace Connector"},sidebar:"kits",previous:{title:"Deployment",permalink:"/docs-kits/next/kits/knowledge-agents/operation-view/deployment"},next:{title:"Provisioning",permalink:"/docs-kits/next/kits/knowledge-agents/operation-view/provider"}},l={},c=[{value:"Quick Setup Guide for Agent-Enabled EDC (KA-EDC)",id:"quick-setup-guide-for-agent-enabled-edc-ka-edc",level:2},{value:"Quick Setup Guide for Registering A Skill",id:"quick-setup-guide-for-registering-a-skill",level:2},{value:"1. Register A Skill Policy",id:"1-register-a-skill-policy",level:3},{value:"2. Register A Skill Contract",id:"2-register-a-skill-contract",level:3},{value:"3. Register a Skill Asset",id:"3-register-a-skill-asset",level:3},{value:"Quick Setup Guide for Calling A Skill",id:"quick-setup-guide-for-calling-a-skill",level:2},{value:"Calling A Locally Deployed Skill",id:"calling-a-locally-deployed-skill",level:3},{value:"Calling A Skill (on the Provider Side)",id:"calling-a-skill-on-the-provider-side",level:3},{value:"Advanced Skills",id:"advanced-skills",level:2}],p={toc:c};function d(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"For participating in Semantic-Web Driven Dataspace Applications following the Catena-X Knowledge Agents Standard, it is recommended to deploy an ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/eclipse-tractusx/knowledge-agents-edc/tree/main/docs/README.md"},"Agent-Plane")," alongside of an existing ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/eclipse-tractusx/tractusx-edc/tree/main/docs/README.md"},"Tractus-X EDC")),(0,i.kt)("p",null,"For more information see"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Our ",(0,i.kt)("a",{parentName:"li",href:"../adoption-view/intro"},"Adoption")," guidelines"),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("a",{parentName:"li",href:"../development-view/architecture"},"Implementation")," documentation"),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("a",{parentName:"li",href:"deployment"},"Deployment")," overview"),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("a",{parentName:"li",href:"testbed"},"Conformity")," testbed"),(0,i.kt)("li",{parentName:"ul"},"A ",(0,i.kt)("a",{parentName:"li",href:"policy"},"Data Sovereignity & Graph Policy")," discussion")),(0,i.kt)("h2",{id:"quick-setup-guide-for-agent-enabled-edc-ka-edc"},"Quick Setup Guide for Agent-Enabled EDC (KA-EDC)"),(0,i.kt)("p",null,"Add a helm dependency to your umbrella/infrastructure Chart.yaml (this example uses the postgresql-hashicorp variant but abstracts away from customer, vault and idta settings - we use yaml star references such as ",(0,i.kt)("em",{parentName:"p"},"vaultsettings")," and ",(0,i.kt)("em",{parentName:"p"},"idtasettings")," for that purpose, see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/eclipse-tractusx/knowledge-agents-edc/tree/main/docs/README.md"},"here")," for more options and full details)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: tractusx-connector\n  alias: my-connector\n  repository: https://eclipse-tractusx.github.io/charts/dev\n  version: 0.7.0\n- name: agent-plane\n  alias: my-agent-plane\n  repository: https://eclipse-tractusx.github.io/charts/dev\n  version: 1.12.19\n")),(0,i.kt)("p",null,"Then configure the connector in the values.yaml"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'my-connector:\n  fullNameOverride: "my-connector"\n  participant:\n    id: BPNL000000001234\n  iatp: *iatpsettings\n  postgresql: *postgresqlsettings\n  vault: *vaultsettings\n  controlplane: &myControlPlane\n    endpoints:\n      management:\n        authKey: *customerApiKey\n    bdrs:\n      server:\n        url: *bdrsUrl\n    ingresses:\n     - enabled: true\n       hostname: "my-connector-control.domain"\n       endpoints:\n         - protocol\n         - management\n         - api\n       tls:\n        enabled: true\n       certManager:\n        clusterIssuer: *clusterIssuer\n    env:\n      EDC_DATAPLANE_SELECTOR_AGENTPLANE_URL: http://my-agent-plane:8087/api/signaling/v1/dataflows\n      EDC_DATAPLANE_SELECTOR_AGENTPLANE_SOURCETYPES: cx-common:Protocol?w3c:http:SPARQL,cx-common:Protocol?w3c:http:SKILL\n      EDC_DATAPLANE_SELECTOR_AGENTPLANE_TRANSFERTYPES: HttpData-PULL\n      EDC_DATAPLANE_SELECTOR_AGENTPLANE_DESTINATIONTYPES: HttpProxy\n      EDC_DATAPLANE_SELECTOR_AGENTPLANE_PROPERTIES: \'{ "publicApiUrl": "https://my-agent.domain/api/public/" }\'\n  dataplane:\n    token: &tokens\n      signer:\n        privatekey_alias: *customerTokenKey\n      verifier:\n        publickey_alias: *customerTokenCert\n\nmy-agent-plane:\n  fullNameOverride: "my-agent-plane"\n  url:\n    public: ""\n  participant:\n    id: *customerBpn\n  iatp: *iatpsettings\n  postgresql: *postgresqlsettings\n  vault: *vaulsettings\n  controlplane: *myControlPlane\n  token: *tokens\n  auth: {}\n  ingresses:\n   - enabled: true\n     hostname: "my-agent-domain"\n     endpoints:\n      - public\n      - default\n     tls:\n      enabled: true\n     certManager:\n      clusterIssuer: *clusterIssuer\n  configs:\n    dataspace.ttl: |-\n        ################################################\n        # Catena-X Agent Bootstrap\n        ################################################\n        @prefix : <GraphAsset?local=Dataspace> .\n        @prefix cx-core: <https://w3id.org/catenax/ontology/core#> .\n        @prefix cx-common: <https://w3id.org/catenax/ontology/common#> .\n        @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .\n        @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .\n        @prefix bpnl: <bpn:legal:> .\n        @base <GraphAsset?local=Dataspace> .\n\n        bpnl:BPNL00000PARTNER cx-common:hasBusinessPartnerNumber "BPNL00000PARTNER"^^xsd:string;\n                            cx-common:hasConnector <edcs://{{partnerConnectorHost}}>.\n\n        bpnl:BPNL000000001234 cx-common:hasBusinessPartnerNumber "BPNL000000001234"^^xsd:string;\n                            cx-common:hasConnector <edcs://my-connector-control>.\n  agent:\n    synchronization: 360000\n    connectors:\n      BPNL00000PARTNER: https://{{partnerConnectorHost}}\n      BPNL000000001234: https://my-connector-control.domain\n')),(0,i.kt)("h2",{id:"quick-setup-guide-for-registering-a-skill"},"Quick Setup Guide for Registering A Skill"),(0,i.kt)("p",null,'A skill is a "stored" dataspace procedure that is offered and executed by agent (planes). In the following, we demonstrate the steps to register one by interacting with the EDC Control Plane Management API and the EDC Data Plane Agent Endpoint'),(0,i.kt)("h3",{id:"1-register-a-skill-policy"},"1. Register A Skill Policy"),(0,i.kt)("p",null,"The following example installs a policy which is just checking the business partner numbers and dataspace memberships\nof the participants. For more realistic policies aligned with the data sovereignity rules/profiles, see ",(0,i.kt)("a",{parentName:"p",href:"policy"},"this discussion"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},'curl --location --globoff \'https://my-connector-control.domain/management/v2/policydefinitions\' \\\n--header \'X-Api-Key: {{customerApiKey}}\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n  "@context": {\n    "@vocab": "https://w3id.org/edc/v0.0.1/ns/",\n    "cx-common": "https://w3id.org/catenax/ontology/common#"\n  },\n  "@id": "Policy?me=Skill",\n  "policy": {\n    "@context": "http://www.w3.org/ns/odrl.jsonld",\n    "@type": "Set",\n    "uid": "https://w3id.org/catenax/ontology/common#Policy?me=Skill",\n    "permission": [\n      {\n        "target": "https://w3id.org/catenax/ontology/common#SkillAsset?me=",\n        "action": "USE",\n        "constraint": {\n           "@type": "LogicalConstraint",\n           "or" : [\n              {\n                "@type" : "Constraint",\n                "leftOperand" : "BusinessPartnerNumber",\n                "operator" :"eq",\n                "rightOperand" : "BPNL00000PARTNER"\n              },\n              {\n                "@type" : "Constraint",\n                "leftOperand" : "BusinessPartnerNumber",\n                "operator" :"eq",\n                "rightOperand" : "BPNL000000001234"\n              }\n            ]\n        }\n     }]\n    }\n}\n\'\n')),(0,i.kt)("h3",{id:"2-register-a-skill-contract"},"2. Register A Skill Contract"),(0,i.kt)("p",null,'The following contract definition exposes upcoming (skill) assets under the previously installed (skill) policy.\nIt does that for both catalogue/offer requests (access policy) and actual agent-based transfers (contract policy). Usually,\nthis makes sense as the party being able to receive and offer should also be able to negotiate a transfer to (here: execute) it.\nNote that this contract foresees a "custom" asset property "cx-common:publishedUnderContract" with which all agent assets can be explictely "assigned"\nto a contract.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},'curl --location --globoff \'https://my-connector-control.domain/management/v2/policydefinitions\' \\\n--header \'X-Api-Key: {{customerApiKey}}\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "@context": {\n         "cx-common": "https://w3id.org/catenax/ontology/common#"\n    },\n    "@id": "Contract?me=Skill",\n    "@type": "ContractDefinition",\n    "accessPolicyId": "Policy?me=Skill",\n    "contractPolicyId": "Policy?me=Skill",\n    "assetsSelector" : [\n     {\n        "@type" : "CriterionDto",\n        "operandLeft": "https://w3id.org/catenax/ontology/common#publishedUnderContract",\n        "operator": "=",\n        "operandRight": "Contract?me=Skill"\n    }\n    ]\n}\n\'\n')),(0,i.kt)("h3",{id:"3-register-a-skill-asset"},"3. Register a Skill Asset"),(0,i.kt)("p",null,"In the next step, we install a stored procedure which traverses the dataspace from the consumer (=skill executor) over an partner oem (providing telematics data and connecting to its suppliers) to a yet unknown supplier (providing a functional graph to perform a prognosis).\nThis skill is the so-called Remaining Useful Life Skill - see the other concrete Graph definitions in this section of the Kit. It requires the partner oem to offer (and federate) at least one corresponding ",(0,i.kt)("a",{parentName:"p",href:"provider"},"(Data) Graph Asset")," to the consumer. It also requires a supplier to offer (and federate) at least one corresponding ",(0,i.kt)("a",{parentName:"p",href:"provider"},"(Function) Graph Asset")," to the partner oem. Correspondence in this regard means that the definition claims the assets to implement certain ontologies (rdfs:isDefinedBy ",(0,i.kt)("a",{parentName:"p",href:"https://w3id.org/catenax/ontology/reliability"},"https://w3id.org/catenax/ontology/reliability"),"). We will show a more advanced way of asset binding/constraining in the following."),(0,i.kt)("p",null,'Note that we use the "distributionMode=ALL" parameter to annotate that this skill may be executed both by the "my-agent.domain" (in the so-called PROVIDER mode - see below) as well as by any remotely executing business partner\'s agent (in the so-called CONSUMER mode see below).\nNote that we use the "contract=Contract%3Fme%3DSkill" parameter to assign this skill to above contract (and policy).\nNote also that we have deployed the agent plane before without specific authentication ("auth: {}") such that we do not have to add any authentication header in the following calls. Please see  ',(0,i.kt)("a",{parentName:"p",href:"https://github.com/eclipse-tractusx/knowledge-agents-edc/tree/main/docs/README.md"},"here")," for how to enable, e.g. JWT/Oauth2 Based authentication and authorization for this endpoint."),(0,i.kt)("p",null,'The result will be that in the associated connector/control plane, a new asset "cx-taxo:SkillAsset?provider=RemainingUsefulLife" is created that can be accessed by "my-agent" as well as any other interested party eligible for the "Contract?me=Skill" contractdefinition.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},'curl --location --globoff \'https://my-agent.domain/api/agent/skill?asset=cx-taxo%3ASkillAsset%3Fprovider%3DRemainingUsefulLife&distributionMode=ALL&contract=contract=Contract%3Fme%3DSkill\' \\\n--header \'Content-Type: application/sparql-query\' \\\n--data-raw \'PREFIX cx-common:       <https://w3id.org/catenax/ontology/common#>\nPREFIX cx-core:         <https://w3id.org/catenax/ontology/core#>\nPREFIX cx-vehicle:      <https://w3id.org/catenax/ontology/vehicle#>\nPREFIX cx-reliability:  <https://w3id.org/catenax/ontology/reliability#>\nPREFIX cx-behaviour:    <https://w3id.org/catenax/ontology/behaviour#>\nPREFIX rdf:             <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX rdfs:            <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX xsd:             <http://www.w3.org/2001/XMLSchema#>\nPREFIX json:            <https://json-schema.org/draft/2020-12/schema#>\nPREFIX bpnl:            <bpn:legal:>\n\n################################################################\n# Sample for a Federated (Consumer-Deployed) SparQL Skill which\n#  - Jumps into an OEM-owned reliability asset given a set of candidate VANs\n#  - Feeds the gathered data back into the respective supplier connector/agent\n#.   to perform a health indication\n# Author: cgjung\n# (c) 2023 Catena-X assocation\n################################################################\n\nSELECT ?vehicle ?van ?aggregate ?assembly ?supplier ?lc ?operatingTime ?mileage ?recordDate ?ls_type ?ls_name ?ls_value ?ls_unit ?ls_method ?ls_channels ?ls_classes ?ls_values ?distanceKm ?timeHours WHERE {\n\n  VALUES (?van ?aggregate ?ls_type) {\n      ("@van"^^xsd:string "Differential Gear"^^xsd:string "GearOil"^^xsd:string)\n  }\n\n  bpnl:BPNL00000PARTNER cx-common:hasConnector ?oemEDC.\n  ?oemEDC cx-common:offers [ rdfs:isDefinedBy <https://w3id.org/catenax/ontology/reliability>; cx-common:id ?reliabilityAssetId].\n\n  SERVICE ?oemEDC {\n      GRAPH ?reliabilityAssetId {\n        ?vehicle rdf:type cx-vehicle:Vehicle;\n            cx-vehicle:vehicleIdentificationNumber ?van.\n\n        ?assembly rdf:type cx-vehicle:Part;\n            cx-vehicle:name ?aggregate;\n            cx-vehicle:isPartOf ?vehicle;\n            cx-vehicle:supplier ?supplier.\n\n        ?teleAnalysis rdf:type cx-reliability:Analysis;\n            cx-reliability:analysedObject ?assembly;\n            cx-reliability:operatingHoursOfVehicle ?operatingTime;\n            cx-reliability:mileageOfVehicle ?mileage;\n            cx-core:startDateTime ?recordDate;\n            cx-reliability:result [\n                cx-core:id ?ls_type;\n                cx-core:name ?ls_name;\n                cx-reliability:countingValue ?ls_value;\n                cx-reliability:countingUnit ?ls_unit;\n                cx-reliability:countingMethod ?ls_method;\n                cx-reliability:channels ?ls_channels;\n                cx-reliability:classes ?ls_classes;\n                cx-reliability:values ?ls_values\n            ].\n    } # OEM#GRAPH\n\n    ?supplier cx-common:hasConnector ?supplierEDC.\n    ?supplierEDC cx-common:offers [ rdfs:isDefinedBy <https://w3id.org/catenax/ontology/behaviour>; cx-common:id ?prognosisAssetId].\n\n    SERVICE ?supplierEDC {\n        GRAPH ?prognosisAssetId {\n            ?invocation a cx-behaviour:RemainingUsefulLife;\n                    cx-behaviour:sender bpnl:BPNL00000003AYRE;\n                    cx-behaviour:senderConnector ?oemEDC;\n                    cx-behaviour:recipient ?supplier;\n                    cx-behaviour:recipientConnector ?supplierEDC;\n                    cx-behaviour:targetDate ?recordDate;\n                    cx-behaviour:timeStamp ?recordDate;\n                    cx-behaviour:component "GearBox";\n                    cx-behaviour:statusDate ?recordDate;\n                    cx-behaviour:statusOperatingHours ?operatingTime;\n                    cx-behaviour:statusMileage ?mileage;\n                    cx-behaviour:countingValue ?ls_value;\n                    cx-behaviour:countingUnit ?ls_unit;\n                    cx-behaviour:countingMethod ?ls_method;\n                    cx-behaviour:headerChannels ?ls_channels;\n                    cx-behaviour:bodyClasses ?ls_classes;\n                    cx-behaviour:bodyCountsList ?ls_values;\n                    cx-behaviour:remainingOperatingHours ?timeHours;\n                    cx-behaviour:remainingRunningDistance ?distanceKm.\n        } # SUPPLIER#GRAPH\n    } # SUPPLIER#CATALOG\n\n  } # OEM#CATALOG\n\n} # SELECT\n\'\n')),(0,i.kt)("h2",{id:"quick-setup-guide-for-calling-a-skill"},"Quick Setup Guide for Calling A Skill"),(0,i.kt)("p",null,"We demonstrate in the following how the above Skill (stored procedure) can be executed hereby invoking agent-protocol based transfers\nbetween the involved EDC's. In each call, we demonstrate how to perform a batch binding, i.e. the Skill is called with a complete set of bound parameters."),(0,i.kt)("h3",{id:"calling-a-locally-deployed-skill"},"Calling A Locally Deployed Skill"),(0,i.kt)("p",null,"If using an local assetid (SkillAsset?provider=RemainingUsefulLife), the agent can directly access any skill that has been registered in its own connector."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},'curl --location --globoff \'https://my-agent.domain/api/agent?asset=cx-taxo%3ASkillAsset%3Fsupplier%3DRemainingUsefulLife\' \\\n--header \'Content-Type: application/sparql-results+json\' \\\n--header \'Accept: application/json\' \\\n--data \'{\n    "head": {\n        "vars": [\n            "van"\n        ]\n    },\n    "results": {\n        "bindings": [\n            {\n                "van": {\n                    "type": "literal",\n                    "value": "FNLQNRVCOFLHAQ"\n                }\n            },\n            {\n                "van": {\n                    "type": "literal",\n                    "value": "FGPTXINYZAVJYK"\n                }\n            },\n            {\n                "van": {\n                    "type": "literal",\n                    "value": "DVAJDTLJMKKZGY"\n                }\n            }\n        ]\n    }\n}\'\n')),(0,i.kt)("h3",{id:"calling-a-skill-on-the-provider-side"},"Calling A Skill (on the Provider Side)"),(0,i.kt)("p",null,'If assuming that the skill has not been registered/stored in our connector, but in a partner/provider connector, we can use a "global" asset id\nwhich starts with the URL of the partner connector\'s dsp endpoint. Furthermore, we are able to\nchoose a run mode by the parameter "runMode=provider". In this case, the consumer agent will negotiate with the provider agent to\nexecute the skill in the provider connector. When we choose "runMode=consumer" instead, the consumer agent will try to "download" the skill\nto the consumer connector and executes it there.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},'curl --location --globoff \'https://my-agent-domain/api/agent?asset=https%3A%2F%2F{{partnerConnectorHost}}%23cx-taxo%3ASkillAsset%3Fprovider%3DRemainingUsefulLife&runMode=provider\' \\\n--header \'Content-Type: application/sparql-results+json\' \\\n--header \'Accept: application/json\' \\\n--data \'{\n    "head": {\n        "vars": [\n            "van"\n        ]\n    },\n    "results": {\n        "bindings": [\n            {\n                "van": {\n                    "type": "literal",\n                    "value": "FNLQNRVCOFLHAQ"\n                }\n            },\n            {\n                "van": {\n                    "type": "literal",\n                    "value": "FGPTXINYZAVJYK"\n                }\n            },\n            {\n                "van": {\n                    "type": "literal",\n                    "value": "DVAJDTLJMKKZGY"\n                }\n            }\n        ]\n    }\n}\'\n')),(0,i.kt)("h2",{id:"advanced-skills"},"Advanced Skills"),(0,i.kt)("p",null,"In the ",(0,i.kt)("a",{parentName:"p",href:"../development-view/modelling"},"Ontology Modelling Guide")," we have demonstrated that a graph (i.e. the (virtual) set of triples comprising the data or function) can not only be described by ontologies (see the above skill making use of the rdfs:isdefinedBy property/predicate), but also by a shape (the sh:shapesGraph property and its resolutions into the cx-sh:shapeObject predicate can be seen much like a statistics which lists the extremal values and distinct counts inside the columns of a table). In the following we\ndemonstrate a more flexible Behaviour Prognosis Skill which will switched between different data and function assets (and hence business partners in the dataspace) depending on the @resultType that should be achived. The relevant shape definitions which make this skill worki can be found in the ",(0,i.kt)("a",{parentName:"p",href:"provider"},"Provider Operation Guide")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"curl --location --globoff 'https://my-agent.domain/api/agent/skill?asset=cx-taxo%3ASkillAsset%3Fprovider%3DBehaviourPrognosis&distributionMode=ALL&contract=contract=Contract%3Fme%3DSkill' \\\n--header 'Content-Type: application/sparql-query' \\\n--data-raw 'PREFIX sh: <http://www.w3.org/ns/shacl#>\nPREFIX schema: <http://schema.org/>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX json: <https://json-schema.org/draft/2020-12/schema#> \nPREFIX cx-sh: <https://w3id.org/catenax/ontology/schema#>\nPREFIX cx-common: <https://w3id.org/catenax/ontology/common#> \nPREFIX cx-core: <https://w3id.org/catenax/ontology/core#>\nPREFIX cx-reliability: <https://w3id.org/catenax/ontology/reliability#> \nPREFIX cx-schema: <https://w3id.org/catenax/ontology/schema#>\nPREFIX cx-vehicle: <https://w3id.org/catenax/ontology/vehicle#>\nPREFIX cx-behaviour: <https://w3id.org/catenax/ontology/behaviour#>\nPREFIX cx-taxo: <https://w3id.org/catenax/taxonomy#>\n\n################################################################\n# Sample for a Provider-Deployed Goal-Oriented SparQL Skill which\n#  - Depending on the targetted result\n#  - Finds the right supplier prognosis asset and its preconditions\n#  - jumps into the OEM-owned reliability asset to obtain the required data\n#  - feeds the gathered data back into the respective supplier connector/agent \n#    to perform a behavioural prognosis\n# Author: cgjung\n# (c) 2023-2024 Catena-X assocation\n################################################################\n\nSELECT DISTINCT ?van ?supplier ?vehicle ?assembly ?operatingTime ?mileage ?prognosis WHERE {\n\n  VALUES (?van ?aggregate ?result_type) { \n      (\"@van\"^^xsd:string \"Differential Gear\"^^xsd:string <@resultType>) \n  }\n\n  # Determine the prognosis assets\n  ?output sh:path ?result_type.\n  ?output cx-sh:outputOf ?functionShape. \n  ?assetFunction cx-sh:shapeObject ?functionShape.\n  ?functionConnector cx-common:offers ?assetFunction.\n  ?functionShape cx-sh:extensionOf* ?parentFunctionShape.\n  ?functionShape sh:targetClass ?function.\n  ?parentFunctionShape sh:property ?functionProperty.\n  ?functionProperty cx-sh:hasAsArgument ?argument.\n  ?functionProperty sh:in ?parameters.\n  ?parameters rdf:rest*/rdf:first ?ls_type.\n\n  # Determine the target\n  ?assetData cx-sh:shapeObject ?nodeShape.\n  ?dataConnector cx-common:offers ?assetData.\n  ?nodeShape sh:property ?propertyShape.\n  ?propertyShape sh:path ?argument. \n  ?propertyShape sh:in ?parameters_target.\n  ?parameters_target rdf:rest*/rdf:first ?ls_type.\n\n  SERVICE ?dataConnector { \n    GRAPH ?assetData { \n        ?vehicle rdf:type cx-vehicle:Vehicle;\n            cx-vehicle:vehicleIdentificationNumber ?van.\n\n         ?assembly rdf:type cx-vehicle:Part;\n            cx-vehicle:name ?aggregate;\n            cx-vehicle:isPartOf ?vehicle;\n            cx-vehicle:supplier ?supplier.\n            \n         ?teleAnalysis rdf:type cx-reliability:Analysis;\n             cx-reliability:analysedObject ?assembly;\n             cx-reliability:operatingHoursOfVehicle ?operatingTime;\n             cx-reliability:mileageOfVehicle ?mileage;\n             cx-core:startDateTime ?recordDate;\n             cx-reliability:result [\n                 cx-core:id ?ls_type;\n                 cx-core:name ?ls_name;\n                 cx-reliability:countingValue ?ls_value;\n                 cx-reliability:countingUnit ?ls_unit;\n                 cx-reliability:countingMethod ?ls_method;\n                 cx-reliability:channels ?ls_channels;\n                 cx-reliability:classes ?ls_classes;\n                 cx-reliability:values ?ls_values\n             ].\n     }\n  }\n\n  SERVICE ?functionConnector {\n    GRAPH ?assetFunction { \n      SELECT ?prognosis WHERE {\n        ?invocation a ?function;\n              cx-behaviour:sender <bpn:legal:BPNLOEM>;\n              cx-behaviour:senderConnector <edc://sender>;\n              cx-behaviour:recipient <bpn:legal:BPNLSUPPLIER>;\n              cx-behaviour:recipientConnector <edc://recipient>;\n              cx-behaviour:targetDate ?recordDate;\n              cx-behaviour:timeStamp ?recordDate;\n              cx-behaviour:component ?assembly;\n              cx-behaviour:observationType ?ls_type;\n              cx-behaviour:statusDate ?recordDate;\n              cx-behaviour:statusOperatingHours ?operatingTime;\n              cx-behaviour:statusMileage ?mileage;\n              cx-behaviour:countingValue ?ls_value;\n              cx-behaviour:countingUnit ?ls_unit;\n              cx-behaviour:countingMethod ?ls_method;\n              cx-behaviour:headerChannels ?ls_channels;\n              cx-behaviour:bodyClasses ?ls_classes;\n              cx-behaviour:bodyCountsList ?ls_values;\n              ?result_type ?prognosis.\n      }\n    }\n  } # SUPPLIER#CATALOG\n\n} # SELECT\n'\n")),(0,i.kt)("p",null,"Here is an invocation which mimiques the original cx-taxo:SkillAsset?provider=RemainingUsefulLife on one vehicle\nand performs a HealthIndication prognosis for another one in a single call."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},'curl --location --globoff \'https://my-agent-domain/api/agent?asset=https%3A%2F%2F{{partnerConnectorHost}}%23cx-taxo%3ASkillAsset%3Fprovider%3DBehaviourPrognosis&runMode=provider\' \\\n--header \'Content-Type: application/sparql-results+json\' \\\n--header \'Accept: application/json\' \\\n--data \'{\n    "head": {\n        "vars": [\n            "van",\n            "resultType"\n        ]\n    },\n    "results": {\n        "bindings": [\n            {\n                "van": {\n                    "type": "literal",\n                    "value": "FNLQNRVCOFLHAQ"\n                },\n                "resultType": {\n                    "type": "uri",\n                    "value": "https://w3id.org/catenax/ontology/behaviour#RemainingUsefulLifeResult"\n                }\n            },\n            {\n                "van": {\n                    "type": "literal",\n                    "value": "FGPTXINYZAVJYK"\n                },\n                "resultType": {\n                    "type": "uri",\n                    "value": "https://w3id.org/catenax/ontology/behaviour#HealthIndicationResult"\n                }\n            }\n        ]\n    }\n}\'\n')),(0,i.kt)("sub",null,(0,i.kt)("sup",null,"(C) 2021,2024 Contributors to the Eclipse Foundation. SPDX-License-Identifier: CC-BY-4.0")))}d.isMDXComponent=!0}}]);