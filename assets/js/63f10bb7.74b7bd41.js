"use strict";(self.webpackChunkeclipse_tractusx_github_io=self.webpackChunkeclipse_tractusx_github_io||[]).push([[28054],{28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var s=t(96540);const r={},i=s.createContext(r);function l(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(i.Provider,{value:n},e.children)}},32425:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/trg-6-1_chart_release_action_tag-error-7fa1d16e631704844e383203bf0f008a.png"},58578:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"release/trg-6/trg-6-1","title":"TRG 6.01 - Released Helm Chart","description":"| Status | Created     | Post-History    |","source":"@site/docs/release/trg-6/trg-6-1.md","sourceDirName":"release/trg-6","slug":"/release/trg-6/trg-6-1","permalink":"/docs/release/trg-6/trg-6-1","draft":false,"unlisted":false,"editUrl":"https://github.com/eclipse-tractusx/eclipse-tractusx.github.io/tree/main/docs/release/trg-6/trg-6-1.md","tags":[],"version":"current","frontMatter":{"title":"TRG 6.01 - Released Helm Chart"},"sidebar":"docs","previous":{"title":"TRG 5.11 - Upgradeability","permalink":"/docs/release/trg-5/trg-5-11"},"next":{"title":"TRG 7.00 - Recurring activities for each PR","permalink":"/docs/release/trg-7/trg-7-00"}}');var r=t(74848),i=t(28453);const l={title:"TRG 6.01 - Released Helm Chart"},a=void 0,o={},c=[{value:"Description",id:"description",level:2},{value:"Why",id:"why",level:2},{value:"Process description",id:"process-description",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Implementation",id:"implementation",level:3},{value:"Don&#39;ts",id:"donts",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Status"}),(0,r.jsx)(n.th,{children:"Created"}),(0,r.jsx)(n.th,{children:"Post-History"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Active"}),(0,r.jsx)(n.td,{children:"01-Dec-2022"}),(0,r.jsx)(n.td,{children:"Initial release"})]})})]}),"\n",(0,r.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,r.jsx)(n.p,{children:"A released Helm chart for each Tractus-X sub-product is expected to be available in corresponding GitHub repository."}),"\n",(0,r.jsx)(n.h2,{id:"why",children:"Why"}),"\n",(0,r.jsxs)(n.p,{children:["Tractus-X components can only be used and bundled with other components of Tractus-X if there is a version of the\ncomponent with reliable content. This can only be achieved by creating a release of your Helm chart. We recommend to use\n",(0,r.jsx)(n.a,{href:"https://github.com/marketplace/actions/helm-chart-releaser",children:"GitHub Chart Releaser Action"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"process-description",children:"Process description"}),"\n",(0,r.jsx)(n.p,{children:"If you follow this recommendation to use GitHub Chart Releaser Action to provide a released Helm Chart for your\nTractus-X sub-product, the process will provide the following for you:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["A GiHub Release is created with","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["a GitHub release, named ",(0,r.jsx)(n.em,{children:"Chartname-Semver"})," (e.g. ",(0,r.jsx)(n.em,{children:"productABC-0.1.1"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["a Git tag ",(0,r.jsx)(n.em,{children:"Chartname-Semver"})]}),"\n",(0,r.jsx)(n.li,{children:"a release asset, containing the Helm chart files"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["A local Helm repository is created (file ",(0,r.jsx)(n.code,{children:"index.yaml"})," in branch ",(0,r.jsx)(n.em,{children:"gh-pages"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Only if you follow this TRG to release a Helm Chart, the released Helm chart will be automatically added to\nthe ",(0,r.jsx)(n.a,{href:"https://eclipse-tractusx.github.io/charts/",children:"central Tractus-X Helm repository"}),"."]})}),"\n",(0,r.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"To get the GitHub Chart Releaser Action working, the following prerequisites must be met:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["A branch named ",(0,r.jsx)(n.code,{children:"gh-pages"})," in your repository"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Change the GitHub Pages source branch to ",(0,r.jsx)(n.code,{children:"gh-pages"})," in your repository settings. Submit request via Otterdog, ensure following are set:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'  gh_pages_build_type:"legacy",\n  gh_pages_source_branch:"gh-pages",\n  gh_pages_source_path:"/",\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Helm charts must be located in folder ",(0,r.jsx)(n.code,{children:"/charts"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["A GitHub Actions Workflow (see section ",(0,r.jsx)(n.a,{href:"#implementation",children:"Implementaion"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,r.jsx)(n.p,{children:"Create a GitHub Workflow file with following content:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'name: Release - Helm Charts\n\non:\n  push:\n    paths:\n      - \'charts/**\'\n    branches:\n      - main\njobs:\n  release:\n    # depending on default permission settings for your org (contents being read-only or read-write for workloads), you will have to add permissions\n    # see: https://docs.github.com/en/actions/security-guides/automatic-token-authentication#modifying-the-permissions-for-the-github_token\n    permissions:\n      contents: write\n    runs-on: ubuntu-latest\n\n    steps:\n      # fetch-depth: 0 is required to determine differences in chart(s)\n      - name: Checkout\n        uses: actions/checkout@v3\n        with:\n          fetch-depth: 0\n\n      - name: Configure Git\n        run: |\n          git config user.name "$GITHUB_ACTOR"\n          git config user.email "$GITHUB_ACTOR@users.noreply.github.com"\n\n      - name: Install Helm\n        uses: azure/setup-helm@v3\n        with:\n          token: ${{ secrets.GITHUB_TOKEN }}\n\n      - name: Run chart-releaser\n        uses: helm/chart-releaser-action@v1.4.1\n        env:\n          CR_TOKEN: "${{ secrets.GITHUB_TOKEN }}"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Each time a changed Helm Chart is pushed (e.g. merge a PR) to ",(0,r.jsx)(n.em,{children:"main"})," branch, the workflow will be triggered."]}),"\n",(0,r.jsx)(n.h3,{id:"donts",children:"Don'ts"}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Changing the ",(0,r.jsx)(n.code,{children:"appVersion"})," requires also changing the ",(0,r.jsx)(n.code,{children:"version"})," in ",(0,r.jsx)(n.code,{children:"Chart.yaml"})]}),"\n",(0,r.jsxs)(n.li,{children:["Chart ",(0,r.jsx)(n.code,{children:"version"})," itself can be increased without changing the ",(0,r.jsx)(n.code,{children:"appVersion"})]}),"\n"]})}),"\n",(0,r.jsxs)(n.p,{children:["If the ",(0,r.jsx)(n.code,{children:"appVersion"})," is increased, also the ",(0,r.jsx)(n.code,{children:"version"})," in ",(0,r.jsx)(n.code,{children:"Chart.yaml"})," must be increased, otherwise the workflow will\nfail:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Chart Releaser Action - Tag error",src:t(32425).A+"",width:"2526",height:"1406"})}),"\n",(0,r.jsx)(n.p,{children:"The Helm chart name and version is used for creating the Git Tag. As the Helm chart version did not increase, the\nworkflow tries to create a Git tag which already exists."})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);