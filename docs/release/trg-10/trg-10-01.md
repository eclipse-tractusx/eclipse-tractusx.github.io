---
title: TRG 10.01 - Code Coverage
sidebar_position: 1
---

| Status | Created     | Post-History            |
|--------|-------------|-------------------------|
| Draft  | 07-Feb-2025 | Initial version created |
| Draft  | 21-Mar-2025 | Update with example integration for Java |

## Why

Goal: To ensure that all released software components meet sufficient test coverage to guarantee quality, stability, and reliability.

This guideline applies to all software components and projects that are part of the Eclipse Tractus-X release process.

## Description

### 1. Minimum Requirements

1.1. **Code Coverage Threshold**

- Quality Gate: The minimum threshold for code coverage (line coverage) should be **80.0%**.
- The code coverage is calculated using both unit tests and integration tests combined.
- Every project not specifically associated to a different Quality Gate will be associated to this one by default.

1.2. **Exceptions**

Certain code sections may be excluded from counting towards the code coverage percentage. For example this could apply to code sections that:

- Are themselves test code (no "test of tests").
- Are autogenerated code, for example Swagger-generated API clients.
- Are configuration files with no logic to test.
- Are experimental or prototype code, for example incomplete implementations hidden behind feature toggles.
- Are boilerplate code or entity classes that follow a known, predictable pattern.
- Are code for logging, metrics, or monitoring.
- Depend on platform-specifics, for example hardware that cannot be simulated in a test.

All exceptions should be documented and approved by the project's lead/main committers.

### 2. Analysis and Reporting

2.1. **Tools for Code Coverage Reporting**

- The recommended code coverage reporting tool is **SonarQube Cloud** as provided by Elipse Tractus-X. [Reference link](https://sonarcloud.io/organizations/eclipse-tractusx/projects)
- Please note that SonarQube Cloud does not calculate the code coverage itself. To include coverage results you must set up a third-party coverage analysis tool and configure SonarQube Cloud to import the analysis results produced by that tool.
- SonarQube Cloud supports the import of coverage data in formats native to a variety of tools for a variety of languages. It also provides a possibility to import a generic format from tools that are not directly supported. See the guideline in section [4. Resources and Examples](#sonarqube-implementation-guides) as reference on how to implement this.
- The tool or tools used for test coverage analysis and to produce the code coverage report should be specified and documented within the respective Eclipse Tractus-X project.

2.2. **Regular Review**

- Code coverage should be measured by all Eclipse Tractus-X software products at least once before each release.
- Coverage measurement results should be integrated into CI/CD pipelines and automated as part of the release process.

### 3. Quality Assurance

3.1. **Code Review Requirements**

- Reviewers must ensure that new or modified code sections are sufficiently covered by test cases.
- Code changes that lower the overall coverage below the defined Quality Gate threshold may only be accepted in exceptional cases.

3.2. **Risk Analysis**

- If the code coverage value for an Eclipse Tractus-X project falls below 80.0% for an (upcoming) release and this cannot be improved anymore in time before the release, this potential risk should be documented and approved by the project lead/main committers.

### 4. Resources and Examples
<a id="sonarqube-implementation-guides"></a>
#### 4.1 **SonarQube Cloud Implementation Guides**

See the following SonarQube Cloud guideline for the importing of test coverage reports with detailed guides for several popular programming languages as [reference](https://docs.sonarsource.com/sonarqube-cloud/enriching/test-coverage/overview/).

#### 4.2. **GitHub Workflow Integration Code Example**

An example of a GitHub workflow integration using Java and Apache Maven can be found below.

```yaml
name: "Run unit and integration tests"

on:
  pull_request:
  workflow_dispatch:
  push:
    branches:
      - main

env:
  JAVA_VERSION: 17

jobs:
  Test-and-Sonar:
    permissions:
      contents: read
      checks: write
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          java-version: '${{ env.JAVA_VERSION }}'
          distribution: 'temurin'
          cache: 'maven'

      - name: Run unit & integration tests
        run: |
          mvn -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn -B verify

      - name: Publish integration test results
        uses: EnricoMi/publish-unit-test-result-action@v2
        if: always()
        with:
          files: "${{ github.workspace }}/target/failsafe-reports/integration-tests.xml"
          check_name: "Integration Test Results"

      - name: Publish unit test results
        uses: EnricoMi/publish-unit-test-result-action@v2
        if: always()
        with:
          files: "**/surefire-reports/unit-tests.xml"
          check_name: "Unit Test Results"
```
